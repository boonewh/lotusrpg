{% extends "base.html" %}

{% block title %}Admin - Manage {{ section.title }}{% endblock %}

{% block content %}
<main class="flex">
    <!-- Side Navigation -->
    <aside class="side-nav bg-gray-800 p-4 w-1/4 min-h-screen">
        <h2 class="text-lg font-semibold text-white mb-4 pt-60">Chapters</h2>
        {% for chapter in chapters %}
        <div class="mb-4">
            <h3 class="text-white font-bold text-md">{{ chapter.title }}</h3>
            <ul class="space-y-2">
                {% for section in chapter.sections %}
                <li>
                    <a href="{{ url_for('admin.manage_page', slug=section.slug) }}" 
                       class="text-blue-400 hover:text-blue-300">
                       {{ section.title }}
                    </a>
                </li>
                {% endfor %}
            </ul>
        </div>
        {% endfor %}
    </aside>

    <!-- Main Content -->
    <div class="container mx-auto py-6 flex-1">
        <h1 class="heading1">Manage "{{ section.title }}"</h1>

        <!-- Edit Section -->
        <div class="bg-gray-800 p-6 rounded-lg shadow-lg mb-6">
            <h2 class="text-2xl font-semibold mb-4">Edit Section</h2>
            <form method="POST">
                {{ section_form.hidden_tag() }}
                <div class="mb-4">
                    {{ section_form.title.label(class="block text-white font-medium mb-2") }}
                    {{ section_form.title(class="form-input w-full text-black") }}
                </div>
                <div class="mb-4">
                    {{ section_form.slug.label(class="block text-white font-medium mb-2") }}
                    {{ section_form.slug(class="form-input w-full text-black") }}
                </div>
                <button type="submit" class="bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded-lg shadow-md">
                    Save Changes
                </button>
            </form>
        </div>

        <!-- Manage Contents -->
        <div class="bg-gray-800 p-6 rounded-lg shadow-lg mb-6">
            <h2 class="text-2xl font-semibold mb-4">Contents</h2>
            <ul class="space-y-4">
                {% for content in contents %}
                <li class="p-4 bg-gray-900 rounded-lg">
                    <div class="flex justify-between items-center">
                        <span><strong>{{ content.content_type }}</strong>: {{ content.content_data }}</span>
                        <button onclick="toggleEditForm('{{ content.id }}');" 
                                class="text-blue-500 hover:text-blue-400 font-medium">
                            Edit
                        </button>
                    </div>

                    <!-- Edit Content Inline Form -->
                    <form id="edit-form-{{ content.id }}" method="POST" class="space-y-2 mt-4 hidden">
                        <input type="hidden" name="content_id" value="{{ content.id }}">
                        <div>
                            <label class="block text-white font-medium">Content Data</label>
                            <textarea name="content_data" 
                                      class="form-input w-full text-black whitespace-normal font-sans">{{ content.content_data|trim|e }}</textarea>
                        </div>
                        <div>
                            <label class="block text-white font-medium">Order</label>
                            <input type="number" name="content_order" 
                                   value="{{ content.content_order|trim|e }}" 
                                   class="form-input w-full text-black whitespace-normal font-sans">
                        </div>
                        <div>
                            <label class="block text-white font-medium">CSS Class</label>
                            <input type="text" name="style_class" 
                                   value="{{ content.style_class|trim|e }}" 
                                   class="form-input w-full text-black whitespace-normal font-sans">
                        </div>
                        <div class="flex justify-end space-x-4">
                            <button type="submit" class="bg-green-500 hover:bg-green-600 text-white py-2 px-4 rounded-lg">
                                Save
                            </button>
                            <button type="submit" name="delete_content_id" value="{{ content.id }}" 
                                    class="bg-red-500 hover:bg-red-600 text-white py-2 px-4 rounded-lg">
                                Delete
                            </button>
                        </div>
                    </form>
                </li>            
                {% endfor %}
            </ul>

            <!-- Add New Content Form -->
            <h3 class="text-xl font-semibold mt-6">Add New Content</h3>
            <form method="POST" class="space-y-4">
                {{ content_form.hidden_tag() }}
                <div>
                    {{ content_form.content_type.label(class="block text-white font-medium mb-2") }}
                    {{ content_form.content_type(class="form-input w-full text-black") }}
                </div>
                <div>
                    {{ content_form.content_order.label(class="block text-white font-medium mb-2") }}
                    {{ content_form.content_order(class="form-input w-full text-black") }}
                </div>
                <div>
                    {{ content_form.content_data.label(class="block text-white font-medium mb-2") }}
                    {{ content_form.content_data(class="form-input w-full text-black") }}
                </div>
                <div>
                    {{ content_form.style_class.label(class="block text-white font-medium mb-2") }}
                    {{ content_form.style_class(class="form-input w-full text-black") }}
                </div>
                <button type="submit" class="bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded-lg shadow-md">
                    Add Content
                </button>
            </form>
        </div>

        <!-- Manage Images -->
        <div class="bg-gray-800 p-6 rounded-lg shadow-lg mb-6">
            <h2 class="text-2xl font-semibold mb-4">Images</h2>
            <ul class="space-y-4">
                {% for image in images %}
                <li class="p-4 bg-gray-900 rounded-lg flex items-center">
                    <img src="{{ image.file_path }}" alt="{{ image.alt_text }}" class="w-16 h-16 rounded-md mr-4">
                    <form method="POST" class="flex-1">
                        <input type="hidden" name="image_id" value="{{ image.id }}">
                        <div class="space-y-2">
                            <input type="text" name="file_path" value="{{ image.file_path }}" class="form-input w-full">
                            <input type="text" name="alt_text" value="{{ image.alt_text }}" class="form-input w-full">
                            <input type="text" name="class_name" value="{{ image.class_name }}" class="form-input w-full">
                        </div>
                        <div class="flex justify-end space-x-4 mt-2">
                            <button type="submit" class="bg-green-500 hover:bg-green-600 text-white py-2 px-4 rounded-lg">
                                Save
                            </button>
                            <button type="submit" name="delete_image_id" value="{{ image.id }}" 
                                    class="bg-red-500 hover:bg-red-600 text-white py-2 px-4 rounded-lg">
                                Delete
                            </button>
                        </div>
                    </form>
                </li>
                {% endfor %}
            </ul>

            <!-- Add New Image Form -->
            <h3 class="text-xl font-semibold mt-6">Add New Image</h3>
            <form method="POST" class="space-y-4">
                {{ image_form.hidden_tag() }}
                <div>
                    {{ image_form.file_path.label(class="block text-white font-medium mb-2") }}
                    {{ image_form.file_path(class="form-input w-full text-black") }}
                </div>
                <div>
                    {{ image_form.alt_text.label(class="block text-white font-medium mb-2") }}
                    {{ image_form.alt_text(class="form-input w-full text-black") }}
                </div>
                <div>
                    {{ image_form.class_name.label(class="block text-white font-medium mb-2") }}
                    {{ image_form.class_name(class="form-input w-full text-black") }}
                </div>
                <button type="submit" class="bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded-lg shadow-md">
                    Add Image
                </button>
            </form>
        </div>
    </div>
</main>

<script>
    function toggleEditForm(contentId) {
        const form = document.getElementById(`edit-form-${contentId}`);
        form.classList.toggle("hidden");
    }
</script>
{% endblock %}
